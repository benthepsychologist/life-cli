aip_id: AIP-2025-11-10-001
context:
  background: 'Life-CLI emerged from orchestrating multiple specialized data tools (Dataverse queries,
    email syncing, calendar syncing, Google Sheets operations, payment processing, assessment scoring)
    for a clinical practice management workflow. Initially considered using Airflow, Meltano, or Taskfile,
    but discovered a gap in the tooling landscape:


    - **Bash scripts**: No structure, no state tracking, grows unmaintainable

    - **Make/Taskfile**: No incremental state, not designed for data pipelines

    - **Airflow/Prefect**: Scheduler-first, web UI overhead, too heavyweight for on-demand CLI workflows

    - **Meltano**: Singer-protocol only, data warehouse focused, not generalized for any CLI tool


    Life-CLI fills the gap: a lightweight orchestrator that provides stateful syncing and workflow management
    for ANY CLI tool, triggered on-demand (e.g., from Neovim), without scheduler or web UI overhead.'
  constraints:
  - 'Must remain lightweight (minimal dependencies: typer, pyyaml, standard library)'
  - No protected paths (this is a greenfield project)
  - Keep orchestration separate from business logic (life-cli calls tools, doesn't implement them)
  - Support both single commands and multi-step workflows
  - YAML config must be human-readable and easy to modify
meta:
  created_at: '2025-11-10T18:52:26.988999+00:00'
  created_by: benthepsychologist
objective:
  acceptance_criteria:
  - Core CLI structure implemented with typer (sync, merge, process, status commands)
  - YAML config loader supporting command templates with variable injection
  - Incremental state tracking with `{extra_args}` pattern for cursor-based syncing
  - Multi-command execution support (commands array)
  - Apache 2.0 LICENSE file in repository
  - README.md with project overview, installation, and basic usage examples
  - Example life.yml configuration demonstrating key features
  - Basic error handling and logging for command execution
  goal: Open-source a stateful, YAML-driven CLI orchestrator that wraps specialized data tools
orchestrator_contract:
  artifacts_dir: .aip_artifacts/AIP-2025-11-10-001
  logging: jsonl
  state_machine:
    events:
    - run_step
    - await_gate
    - approve
    - reject
    - retry
    - escalate
    - complete
    states:
    - pending
    - running
    - awaiting_human
    - failed
    - succeeded
    - rolled_back
plan:
- description: Project Scaffolding
  gate_ref: 'G0: Structure Approval'
  kind: code
  outputs:
  - pyproject.toml
  - LICENSE
  - .gitignore
  - src/life/__init__.py
  - src/life/cli.py
  prompt: 'Create the basic project structure for life-cli:

    1. Set up Python package structure with `src/life/` directory

    2. Create `pyproject.toml` with dependencies (typer, pyyaml)

    3. Add Apache 2.0 LICENSE file

    4. Create initial `.gitignore` for Python projects

    5. Set up basic project metadata (version 0.1.0)'
  role: coding_agent
  step_id: step-001
- description: Core CLI Framework
  gate_ref: 'G1: CLI Foundation'
  kind: code
  outputs:
  - src/life/cli.py
  - src/life/config.py
  - src/life/commands/sync.py
  - src/life/commands/merge.py
  - src/life/commands/process.py
  - src/life/commands/status.py
  prompt: 'Implement the base CLI structure using typer:

    1. Create main CLI app with subcommands: sync, merge, process, status

    2. Implement config loader that reads YAML from `~/life.yml` or specified path

    3. Add `--config` global option for custom config file paths

    4. Add `--dry-run` global option for preview mode

    5. Implement basic logging setup (console output with timestamps)'
  role: coding_agent
  step_id: step-002
- description: State Management & Incremental Sync
  gate_ref: 'G2: Core Feature'
  kind: code
  outputs:
  - src/life/state.py
  - src/life/runner.py
  prompt: 'Implement stateful incremental syncing:

    1. Create state manager that reads/writes JSON state files

    2. Implement `{extra_args}` variable injection for incremental syncs

    3. Build cursor-based pagination support using `incremental_field` and `state_file`

    4. Add state tracking per sync task (last sync timestamp, high-water marks)

    5. Support `--full-refresh` flag to bypass state and run full sync'
  role: coding_agent
  step_id: step-003
- description: Multi-Command & Workflow Support
  gate_ref: 'G3: Workflow Features'
  kind: code
  outputs:
  - src/life/utils.py
  prompt: 'Add support for complex workflows:

    1. Support `commands` array (multiple commands in sequence)

    2. Implement variable substitution for config fields (`{clients_file}`, `{from_date}`, etc.)

    3. Add date range helpers (`{from_date}`, `{to_date}` based on `date_range` config)

    4. Support append-mode outputs with `append_template` and timestamp injection

    5. Implement output path expansion (tilde and environment variables)'
  role: coding_agent
  step_id: step-004
- description: Documentation & Example Config
  gate_ref: 'G4: Release Readiness'
  kind: code
  outputs:
  - README.md
  - examples/life.yml
  - CONTRIBUTING.md
  - docs/ARCHITECTURE.md
  prompt: 'Create comprehensive documentation:

    1. Write README.md with project overview, installation, usage examples

    2. Create example `life.yml` demonstrating sync, merge, process, status commands

    3. Add inline code comments for key functions

    4. Create CONTRIBUTING.md with development setup instructions

    5. Add example workflows section showing common patterns'
  role: coding_agent
  step_id: step-005
repo:
  default_branch: main
  url: git@github.com:benthepsychologist/life-cli.git
  working_branch: main
tier: C
title: Life-CLI - Lightweight CLI Orchestrator for Personal Data Pipelines
version: '0.1'

