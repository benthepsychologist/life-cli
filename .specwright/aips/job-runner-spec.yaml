aip_id: AIP-life-job-runner-2025-12-09-001
context:
  background: "life-cli currently orchestrates external CLI tools via subprocess:\n\n```yaml\nsync:\n\
    \  contacts:\n    command: \"dv query contacts --select firstname,lastname {extra_args}\"\n    output:\
    \ ~/data/contacts.json\n```\n\nThis works but has limitations:\n1. **Subprocess overhead** - Each\
    \ call spawns a new process\n2. **No shared auth** - Each tool manages its own tokens\n3. **Limited\
    \ error handling** - Only exit codes, no structured errors\n4. **No tracing** - Can't correlate operations\
    \ across tools\n\nMeanwhile, `morch` now provides clean Python clients for Dataverse and Graph APIs."
  constraints:
  - Must remain backwards compatible with existing YAML-based workflows
  - New job runner is additive (`life run`) alongside existing commands
  - Keep dependencies minimal (add `morch`, keep everything else)
  - YAML for job definitions (not JSON - this is a personal tool)
  - No scheduling - still on-demand execution
  - Local event logging (JSONL file)
  - '`shell` steps are transitional only - new jobs should use Python functions'
created: '2025-12-09T10:00:00+00:00'
meta:
  created_at: '2025-12-09T10:00:00+00:00'
  created_by: benthepsychologist
objective:
  acceptance_criteria:
  - '`life run <job_id>` command executes jobs from YAML definitions'
  - '`life jobs list` shows available jobs with descriptions'
  - '`life jobs show <job_id>` displays job definition'
  - Jobs are sequences of steps, each step calls a Python function via `call:`
  - '`life_jobs.dataverse` module with morch-based helper functions'
  - '`life_jobs.graph` module with morch-based helper functions'
  - '`shell` step type for legacy subprocess commands (transitional only)'
  - Event logging to local JSONL file with correlation IDs
  - '`--dry-run` mode shows what would execute'
  - Backwards compatible with existing `life sync/merge/process` commands
  - Tests for job runner and life_jobs modules
  goal: Transform life-cli into a job runner for arbitrary Python functions, using morch for Microsoft
    API operations
orchestrator_contract:
  artifacts_dir: .aip_artifacts/AIP-life-job-runner-2025-12-09-001
  logging: jsonl
  state_machine:
    events:
    - run_step
    - await_gate
    - approve
    - reject
    - retry
    - escalate
    - complete
    states:
    - pending
    - running
    - awaiting_human
    - failed
    - succeeded
    - rolled_back
plan:
- description: Core Job Runner
  kind: code
  role: coding_agent
  step_id: step-001
- description: CLI Commands
  kind: code
  role: coding_agent
  step_id: step-002
- description: life_jobs Module
  kind: code
  role: coding_agent
  step_id: step-003
- description: Example Jobs & Documentation
  kind: code
  role: coding_agent
  step_id: step-004
project_slug: life-job-runner
repo:
  default_branch: main
  url: git@github.com:benthepsychologist/life-cli.git
  working_branch: main
spec_version: 1.0.0
tier: C
title: 'life-cli Job Runner: morch Integration'
updated: '2025-12-09T11:00:00+00:00'
version: '0.1'

